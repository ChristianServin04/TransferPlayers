<!DOCTYPE html>
<html lang="es">
{% load static %}
<head>
  <meta charset="UTF-8">
  <title>Panel de Administración | Transfer Players</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="{% static 'css/styles.css' %}">
</head>
<body>
  <!-- Barra de navegación -->
  <nav class="navbar navbar-expand-lg" style="background-color: rgba(5,19,23,255)">
    <div class="container">
      <img src="{% static 'img/LogotransferPlayer.png' %}" alt="Transfer Players Logo" class="logo" style="width:80px;">
      <a class="navbar-brand" href="#" style="color: antiquewhite; font-weight:600;">
        Transfer Players
      </a>
      <div class="collapse navbar-collapse justify-content-end">
        <a href="home.html" class="btn btn-link" style="color: antiquewhite">Inicio</a>
        <a href="{% url 'home' %}" class="btn btn-danger">Inicio</a>
      </div>
    </div>
  </nav>

  <!-- Contenedor principal -->
  <div class="container mt-4">
    <h1 class="display-5 fw-bold">Panel de Administración</h1>
    <p class="lead">Aquí puedes administrar registros de la base de datos.</p>

    <!-- Sección de administración de jugadores -->
    <div class="card mt-4">
      <div class="card-header d-flex justify-content-between align-items-center">
        <span class="h5">Jugadores</span>
        <div>
          <select class="form-select d-inline-block w-auto me-2" id="filtroEstatus">
            <option value="todos">Todos</option>
            <option value="activos">Activos</option>
            <option value="inactivos">Inactivos</option>
          </select>
          <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#modalNuevoJugador">Agregar Jugador</button>
        </div>
      </div>
      <div class="card-body row">
        <div class="table-responsive">
          <table class="table table-striped">
            <thead>
              <tr>
                <th>Nombre</th>
                <th>Edad</th>
                <th>Posición</th>
                <th>Valor de Mercado</th>
                <th>Equipo</th>
                <th>Fecha Nacimiento</th>
                <th>Estatus</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody>
              {% for jugador in jugadores %}
              <tr>
                <td>{{ jugador.nombre }}</td>
                <td>{{ jugador.edad }}</td>
                <td>{{ jugador.posicion }}</td>
                <td>{{ jugador.valor_mercado }}</td>
                <td>{{ jugador.equipo }}</td>
                <td>{{ jugador.fecha_nacimiento }}</td>
                <td>{{ jugador.estatus }}</td>
                <td>
                  <button class="btn btn-info btn-sm" data-bs-toggle="modal" data-bs-target="#modalRegistrosJugador">Agregar Registros</button>
                  <button class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#modalModificarJugador">Modificar</button>
                  <button class="btn btn-danger btn-sm" data-bs-toggle="modal" data-bs-target="#modalDarDeBajaJugador">Dar de baja</button>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>

      <!-- Modal para agregar nuevo jugador -->
      <div class="modal fade" id="modalNuevoJugador" tabindex="-1" aria-labelledby="modalNuevoJugadorLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="modalNuevoJugadorLabel">Agregar Nuevo Jugador</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
            </div>
            <form method="POST">
              {% csrf_token %}
              <div class="modal-body row g-3">
                <div class="col-md-6">
                  <label class="form-label">Nombre</label>
                  <input type="text" name="nombre" class="form-control" required>
                </div>
                <div class="col-md-3">
                  <label class="form-label">Edad</label>
                  <input type="number" name="edad" class="form-control" required>
                </div>
                <div class="col-md-3">
                  <label class="form-label">Posición</label>
                  <input type="text" name="posicion" class="form-control" required>
                </div>
                <div class="col-md-6">
                  <label class="form-label">Valor de Mercado</label>
                  <input type="number" name="valor_mercado" class="form-control" required>
                </div>
                <div class="col-md-6">
                  <label class="form-label">Equipo</label>
                  <input type="text" name="equipo" class="form-control" required>
                </div>
                <div class="col-md-4">
                  <label class="form-label">Fecha de Nacimiento</label>
                  <input type="date" name="fecha_nacimiento" class="form-control" required>
                </div>
              </div>
              <div class="modal-footer">
                <button type="submit" class="btn btn-success">Guardar Jugador</button>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
              </div>
            </form>
          </div>
        </div>
      </div>

      <!-- Modal para modificar un jugador -->
      <div class="modal fade" id="modalModificarJugador" tabindex="-1" aria-labelledby="modalModificarJugadorLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="modalModificarJugadorLabel">Modificar Jugador</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
            </div>
            <form method="POST">
              {% csrf_token %}
              <div class="modal-body row g-3">
                <div class="col-md-6">
                  <label class="form-label">Nombre</label>
                  <input type="text" name="nombre" class="form-control" required>
                </div>
                <div class="col-md-3">
                  <label class="form-label">Edad</label>
                  <input type="number" name="edad" class="form-control" required>
                </div>
                <div class="col-md-3">
                  <label class="form-label">Posición</label>
                  <input type="text" name="posicion" class="form-control" required>
                </div>
                <div class="col-md-6">
                  <label class="form-label">Valor de Mercado</label>
                  <input type="number" name="valor_mercado" class="form-control" required>
                </div>
                <div class="col-md-6">
                  <label class="form-label">Equipo</label>
                  <input type="text" name="equipo" class="form-control" required>
                </div>
                <div class="col-md-4">
                  <label class="form-label">Fecha de Nacimiento</label>
                  <input type="date" name="fecha_nacimiento" class="form-control" required>
                </div>
              </div>
              <div class="modal-footer">
                <button type="submit" class="btn btn-success">Guardar Jugador</button>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
              </div>
            </form>
          </div>
        </div>
      </div>

      <!-- Modal para agregar registros a un jugador -->
      <div class="modal fade" id="modalRegistrosJugador" tabindex="-1" aria-labelledby="modalRegistrosJugador" aria-hidden="true">
        <div class="modal-dialog modal-lg">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="modalRegistrosJugador">Agregar Registros de Jugador</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
            </div>
            <form method="POST">
              {% csrf_token %}
              <div class="modal-body row g-3">
                <div class="col-md-6">
                  <label class="form-label">Nombre</label>
                  <input type="text" name="nombre" class="form-control" required>
                </div>
                <div class="col-md-3">
                  <label class="form-label">Edad</label>
                  <input type="number" name="edad" class="form-control" required>
                </div>
                <div class="col-md-3">
                  <label class="form-label">Posición</label>
                  <input type="text" name="posicion" class="form-control" required>
                </div>
                <div class="col-md-6">
                  <label class="form-label">Valor de Mercado</label>
                  <input type="number" name="valor_mercado" class="form-control" required>
                </div>
                <div class="col-md-6">
                  <label class="form-label">Equipo</label>
                  <input type="text" name="equipo" class="form-control" required>
                </div>
                <div class="col-md-4">
                  <label class="form-label">Fecha de Nacimiento</label>
                  <input type="date" name="fecha_nacimiento" class="form-control" required>
                </div>
              </div>
              <div class="modal-footer">
                <button type="submit" class="btn btn-success">Guardar Registro</button>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
              </div>
            </form>
          </div>
        </div>
      </div>

      <!-- Modal para dar de baja un jugador -->
      <div class="modal fade" id="modalDarDeBajaJugador" tabindex="-1" aria-labelledby="modalDarDeBajaJugador" aria-hidden="true">
        <div class="modal-dialog modal-lg">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="modalDarDeBajaJugador">Dar de baja un jugador</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
            </div>
            <form method="POST">
              <label class="form-label">¿Seguro que quiere dar de baja al jugador?</label>
              <div class="modal-footer">
                <button type="submit" class="btn btn-danger">Dar de baja a Jugador</button>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
              </div>
            </form>
          </div>
        </div>
      </div>

    </div>

    <!-- Sección de atención de solicitudes -->
    <div class="card mt-4">
      <div class="card-header d-flex justify-content-between align-items-center">
        <span class="h5">Solicitudes</span>
      </div>
      <div class="card-body">
        <div class="table-responsive">
          <table class="table table-striped">
            <thead>
              <tr>
                <th>Usuario</th>
                <th>Jugador</th>
                <th>Solicitud</th>
                <th>Fecha</th>
                <th>Estatus</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody>
              {% for solicitud in solicitudes %}
                {% if solicitud.estatus == 'pendiente' %}
                  <tr>
                    <td>{{ solicitud.usuario.nombre }}</td>
                    <td>{{ solicitud.jugador.nombre }}</td>
                    <td>{{ solicitud.texto }}</td>
                    <td>{{ solicitud.fecha }}</td>
                    <td><span class="badge bg-warning text-dark">Pendiente</span></td>
                    <td>
                      <button class="btn btn-success btn-sm" data-bs-toggle="modal" data-bs-target="#modalResponderSolicitud{{ solicitud.id }}">Contestar</button>
                      <form action="{% url 'rechazar_solicitud' solicitud.id %}" method="POST" class="d-inline">
                        {% csrf_token %}
                        <button class="btn btn-danger btn-sm" onclick="return confirm('¿Seguro que quieres rechazar esta solicitud?')">Rechazar</button>
                      </form>
                    </td>
                  </tr>

                  <!-- Modal para responder -->
                  <div class="modal fade" id="modalResponderSolicitud{{ solicitud.id }}" tabindex="-1" aria-labelledby="modalResponderLabel{{ solicitud.id }}" aria-hidden="true">
                    <div class="modal-dialog modal-lg">
                      <div class="modal-content">
                        <div class="modal-header">
                          <h5 class="modal-title" id="modalResponderLabel{{ solicitud.id }}">Responder Solicitud</h5>
                          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                        </div>
                        <form action="{% url 'responder_solicitud' solicitud.id %}" method="POST">
                          {% csrf_token %}
                          <div class="modal-body">
                            <p><strong>Usuario:</strong> {{ solicitud.usuario.nombre }}</p>
                            <p><strong>Jugador:</strong> {{ solicitud.jugador.nombre }}</p>
                            <p><strong>Solicitud:</strong> {{ solicitud.texto }}</p>

                            <div class="mb-3">
                              <label class="form-label">Respuesta</label>
                              <textarea name="respuesta" class="form-control" rows="4" required></textarea>
                            </div>
                          </div>
                          <div class="modal-footer">
                            <button type="submit" class="btn btn-success">Enviar Respuesta</button>
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                          </div>
                        </form>
                      </div>
                    </div>
                  </div>
                {% endif %}
              {% endfor %}
              {% if solicitudes|length == 0 %}
                <tr>
                  <td colspan="6" class="text-center">No hay solicitudes pendientes.</td>
                </tr>
              {% endif %}
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Sección de administración de usuarios -->
    <div class="card mt-4">
      <div class="card-header d-flex justify-content-between align-items-center">
        <span class="h5">Usuarios</span>
        <div>
          <select class="form-select d-inline-block w-auto me-2" id="filtroUsuariosEstatus" onchange="filtrarUsuarios()">
            <option value="todos">Todos</option>
            <option value="activos">Activos</option>
            <option value="inactivos">Inactivos</option>
          </select>
          <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#modalAgregarUsuario">Agregar Usuario</button>
        </div>
      </div>
      <div class="card-body">
        <div class="table-responsive">
          <table class="table table-striped">
            <thead>
              <tr>
                <th>ID</th>
                <th>Nombre</th>
                <th>Tipo de Usuario</th>
                <th>Correo</th>
                <th>Estatus</th>
                <th>Fecha Registro</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody>
              {% for usuario in usuarios %}
              <tr>
                <td>{{ usuario.id_usuario }}</td>
                <td>{{ usuario.nombre }}</td>
                <td>{{ usuario.tipo_usuario }}</td>
                <td>{{ usuario.correo }}</td>
                <td>
                  {% if usuario.status == 1 %}
                    <span class="badge bg-success">Activo</span>
                  {% else %}
                    <span class="badge bg-secondary">Inactivo</span>
                  {% endif %}
                </td>
                <td>{{ usuario.fecha_registro }}</td>
                <td>
                  <button class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#modalModificarUsuario{{ usuario.id_usuario }}">Modificar</button>
                  <form action="{% url 'eliminar_usuario' usuario.id_usuario %}" method="POST" class="d-inline">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('¿Estás seguro que deseas eliminar este usuario?')">Eliminar</button>
                  </form>
                </td>
              </tr>

              <!-- Modal para modificar usuario -->
              <div class="modal fade" id="modalModificarUsuario{{ usuario.id_usuario }}" tabindex="-1" aria-labelledby="modalModificarUsuarioLabel{{ usuario.id_usuario }}" aria-hidden="true">
                <div class="modal-dialog modal-lg">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h5 class="modal-title" id="modalModificarUsuarioLabel{{ usuario.id_usuario }}">Modificar Usuario</h5>
                      <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                    </div>
                    <form action="{% url 'modificar_usuario' usuario.id_usuario %}" method="POST">
                      {% csrf_token %}
                      <div class="modal-body row g-3">
                        <div class="col-md-6">
                          <label class="form-label">Nombre</label>
                          <input type="text" name="nombre" value="{{ usuario.nombre }}" class="form-control" required>
                        </div>
                        <div class="col-md-6">
                          <label class="form-label">Tipo de Usuario</label>
                          <select name="tipo_usuario" class="form-select" required>
                            <option value="Admin" {% if usuario.tipo_usuario == "Admin" %}selected{% endif %}>Admin</option>
                            <option value="Directivo" {% if usuario.tipo_usuario == "Directivo" %}selected{% endif %}>Directivo</option>
                            <option value="Representante" {% if usuario.tipo_usuario == "Representante" %}selected{% endif %}>Representante</option>
                          </select>
                        </div>
                        <div class="col-md-6">
                          <label class="form-label">Correo</label>
                          <input type="email" name="correo" value="{{ usuario.correo }}" class="form-control" required>
                        </div>
                        <div class="col-md-6">
                          <label class="form-label">Cambiar Contraseña (opcional)</label>
                          <input type="password" name="nueva_contrasena" class="form-control" minlength="8">
                        </div>
                        <div class="col-md-4">
                          <label class="form-label">Estatus</label>
                          <select name="status" class="form-select">
                            <option value="1" {% if usuario.status == 1 %}selected{% endif %}>Activo</option>
                            <option value="0" {% if usuario.status == 0 %}selected{% endif %}>Inactivo</option>
                          </select>
                        </div>
                        <div class="col-md-4">
                          <label class="form-label">Fecha Registro</label>
                          <input type="date" name="fecha_registro" value="{{ usuario.fecha_registro }}" class="form-control" required>
                        </div>
                      </div>
                      <div class="modal-footer">
                        <button type="submit" class="btn btn-success">Guardar Cambios</button>
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                      </div>
                    </form>
                  </div>
                </div>
              </div>
              {% endfor %}
              {% if usuarios|length == 0 %}
                <tr><td colspan="7" class="text-center">No hay usuarios registrados.</td></tr>
              {% endif %}
            </tbody>
          </table>
        </div>
      </div>

      <!-- Modal para agregar nuevo usuario -->
      <div class="modal fade" id="modalAgregarUsuario" tabindex="-1" aria-labelledby="modalAgregarUsuarioLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="modalAgregarUsuarioLabel">Agregar Nuevo Usuario</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
            </div>
            <form method="POST" action="{% url 'agregar_usuario' %}">
              {% csrf_token %}
              <div class="modal-body row g-3">
                <div class="col-md-6">
                  <label class="form-label">Nombre</label>
                  <input type="text" name="nombre" class="form-control" maxlength="100" required>
                </div>
                <div class="col-md-6">
                  <label class="form-label">Tipo de Usuario</label>
                  <select name="tipo_usuario" class="form-select" required>
                    <option value="Admin">Admin</option>
                    <option value="Directivo">Directivo</option>
                    <option value="Representante">Representante</option>
                  </select>
                </div>
                <div class="col-md-6">
                  <label class="form-label">Correo</label>
                  <input type="email" name="correo" class="form-control" maxlength="100" required>
                </div>
                <div class="col-md-6">
                  <label class="form-label">Contraseña</label>
                  <input type="password" name="contrasena" class="form-control" minlength="8" required>
                </div>
                <div class="col-md-4">
                  <label class="form-label">Estatus</label>
                  <select name="status" class="form-select" required>
                    <option value="1">Activo</option>
                    <option value="0">Inactivo</option>
                  </select>
                </div>
                <div class="col-md-4">
                  <label class="form-label">Fecha de Registro</label>
                  <input type="date" name="fecha_registro" class="form-control" required>
                </div>
              </div>
              <div class="modal-footer">
                <button type="submit" class="btn btn-success">Guardar Usuario</button>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
              </div>
            </form>
          </div>
        </div>
      </div>

    </div>

  </div>

  <!-- Scripts de Bootstrap -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
